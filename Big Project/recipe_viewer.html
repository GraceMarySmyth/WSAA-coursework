<!DOCTYPE html>
<html>
<head>
    <title>Smyth Family Recipes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #edf1b4;
            margin: 0;
            padding: 20px;
        }
        h1 {
            color: #333;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #d366b2;
        }
        button {
            background-color: #3ebee6;
            border: none;
            color: white;
            padding: 10px 20px;
            font-size: 16px;
            margin-top: 10px;
            cursor: pointer;
        }
        button:hover {
            background-color: #3922a1;
        }
        #createForm {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            height: auto;
            overflow: hidden;
        }

        #createForm.visible {
            opacity: 1;
            visibility: visible;
        }
        
    </style>
</head>
<body>
    <h1>Smyth Family Recipes</h1>
    <h2>Welcome to the recipe viewer</h2>
    <p>Here you can view, create, update, and delete recipes.</p>

    <div>
        <button onclick="showCreateForm()">Create a recipe</button><br/><br/>
        <button onclick="location.reload()">View all recipes</button><br/><br/>
    </div>

    <div>
        <table id="RecipeTable" border="1">
            <thead>
                <tr>
                    <th>id</th>
                    <th>Name of recipe</th>
                    <th>Meal type</th>
                    <th>Number of Ingredients</th>
                    <th>Ingredient List</th>
                    <th>Time</th>
                    <th>Method</th>
                    <th>Update</th>
                    <th>Delete</th>
                </tr>
            </thead>
            <tbody>
                <!-- Recipe data will be populated here by JavaScript -->
            </tbody>
        </table>
    </div>

    <div id="createForm">
        <h2 id="formTitle">Create a Recipe</h2>
        <form id="recipeForm" onsubmit="saveRecipe(event)">
            <input type="hidden" id="recipeId" name="id">

            <label>Name of Recipe:</label><br/>
            <input type="text" id="recipeName" required><br/>

            <label>Meal Type:</label><br/>
            <input type="text" id="mealType" required><br/>

            <label>Number of Ingredients:</label><br/>
            <input type="number" id="ingredientCount" required><br/>

            <label>Ingredient List:</label><br/>
            <input type="text" id="ingredientList" required><br/>

            <label>Time:</label><br/>
            <input type="text" id="recipeTime" required><br/>

            <label>Method:</label><br/>
            <textarea id="recipeMethod" required></textarea><br/>

            <label>Skill Level:</label><br/>
            <select id="difficulty">
                <option value="Easy">Easy Recipe</option>
                <option value="Moderate">Some skills required</option>
                <option value="Difficult">Time and skills required</option>
            </select><br/><br/>

            <button type="submit">Save Recipe</button>
        </form>
    </div>

    <script>
        const API_URL = "http://localhost:5000/recipes";

        document.addEventListener("DOMContentLoaded", function () {
            function showCreateForm() {
                document.getElementById("recipeForm").reset(); // Reset the form
                document.getElementById("recipeId").value = ""; // Clear the hidden ID field
                document.getElementById("createForm").style.display = "block";
            }
            function hideCreateForm() {
                document.getElementById("createForm").classList.remove("visible");
            }
            function loadRecipes() {
                fetch(API_URL)
                    .then(response => {
                        if (!response.ok) throw new Error('Network error: ' + response.statusText);
                        return response.json();
                    })
                    .then(recipes => {
                        const tableBody = document.querySelector("#RecipeTable tbody");
                        tableBody.innerHTML = "";
                        if (recipes.length === 0) {
                            tableBody.innerHTML = "<tr><td colspan='9'>No recipes found.</td></tr>";
                        } else {
                            recipes.forEach(recipe => {
                                const row = document.createElement("tr");
                                row.innerHTML = `
                                    <td>${recipe.id}</td>
                                    <td>${recipe.name}</td>
                                    <td>${recipe.meal_type}</td>
                                    <td>${recipe.ingredients_count}</td>
                                    <td>${recipe.ingredients_list}</td>
                                    <td>${recipe.time}</td>
                                    <td>${recipe.method}</td>
                                    <td><button onclick="editRecipe(${recipe.id})">Update</button></td>
                                    <td><button onclick="deleteRecipe(${recipe.id})">Delete</button></td>
                                `;
                                tableBody.appendChild(row);
                            });
                        }
                    })
                    .catch(error => {
                        console.error("Error fetching recipes:", error);
                        const tableBody = document.querySelector("#RecipeTable tbody");
                        tableBody.innerHTML = "<tr><td colspan='9'>Error loading recipes.</td></tr>";
                    });
            }

            function saveRecipe(event) {
                if (event) event.preventDefault();
                const id = document.getElementById("recipeId").value;
                const recipe = {
                    name: document.getElementById("recipeName").value,
                    meal_type: document.getElementById("mealType").value,
                    ingredients_count: parseInt(document.getElementById("ingredientCount").value),
                    ingredients_list: document.getElementById("ingredientList").value,
                    time: document.getElementById("recipeTime").value,
                    method: document.getElementById("recipeMethod").value
                };

                const method = id ? "PUT" : "POST"; // Use PUT for update, POST for create
                const url = id ? `${API_URL}/${id}` : API_URL;

                fetch(url, {
                    method: method,
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(recipe)
                }).then(response => {
                    if (response.ok) {
                        alert("Recipe saved!");
                        hideCreateForm();
                        document.getElementById("createForm").style.display = "none";
                        document.getElementById("recipeForm").reset();
                        document.getElementById("recipeId").value = ""; 
                        loadRecipes();
                        document.getElementById("RecipeTable").scrollInToView({ behavior: "smooth" }); // Scroll to the table
                    } else {
                        alert("Failed to save recipe.");
                    }
                });
            }

            window.editRecipe = function(id) {
                fetch(`${API_URL}/${id}`)
                    .then(response => response.json())
                    .then(data => {
                        document.getElementById("recipeId").value = data.id;
                        document.getElementById("recipeName").value = data.name;
                        document.getElementById("mealType").value = data.meal_type;
                        document.getElementById("ingredientCount").value = data.ingredients_count;
                        document.getElementById("ingredientList").value = data.ingredients_list;
                        document.getElementById("recipeTime").value = data.time;
                        document.getElementById("recipeMethod").value = data.method;
                        document.getElementById("createForm").style.display = "block";
                    });
            };

            window.deleteRecipe = function(id) {
                fetch(`${API_URL}/${id}`, {
                    method: "DELETE"
                }).then(response => {
                    if (response.ok) {
                        alert("Recipe deleted successfully!");
                        loadRecipes();
                    } else {
                        alert("Failed to delete recipe.");
                    }
                });
            };

            window.saveRecipe = saveRecipe;
            window.showCreateForm = showCreateForm;
            window.hideCreateForm = hideCreateForm;
            window.loadRecipes = loadRecipes;
            // Load on start
            loadRecipes();
        });
    </script>
</body>
</html>
