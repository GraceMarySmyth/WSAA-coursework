<html>
    <head>
        <title>Smyth Family Recipes</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                background-color: #edf1b4; /* light green */
                margin: 0;
                padding: 20px;
            }
            h1 {
                color: #333;
            }
            table {
                width: 100%;
                border-collapse: collapse;
            }
            th, td {
                padding: 10px;
                text-align: left;
                border-bottom: 1px solid #ddd;
            }
            th {
                background-color: #d366b2; /* pink */
            }
            button {
                background-color: #3ebee6; /* blue */
                border: none;
                color: white;
                padding: 10px 20px;
                text-align: center;
                text-decoration: none;
                display: inline-block;
                font-size: 16px;
                margin-top: 10px;
                cursor: pointer;
            }
            button:hover {
                background-color: #3922a1; /* dark blue */
            }
            #createForm {
                margin-top: 30px;
            }
        </style>
    </head>
    <body>
        <h1>Smyth Family Recipes</h1>

        <h2>Welcome to the recipe viewer</h2>

        <p>Here you can view, create, update, and delete recipes.</p>
        <!--   
        <p>Click the button below to create a new recipe.</p>
        <p>Click the button below to view all recipes.</p>  
        <p>Click the button below to update a recipe.</p>
        <p>Click the button below to delete a recipe.</p>
        <p>Click the button below to view a recipe.</p>
        <p>Click the button below to view a recipe by id.</p>
        <p>Click the button below to view a recipe by name.</p>
        <p>Click the button below to view a recipe by meal type.</p>
        <p>Click the button below to view a recipe by number of ingredients.</p>
        <p>Click the button below to view a recipe by time.</p>
     -->  
        <div>
            <button onclick="showCreateForm()">Create a recipe</button><br/><br/>
            <button onclick="location.reload()">View all recipes</button><br/><br/>
        </div>
        
        <div>
            <table id="RecipeTable" border="1">
                <thead>
                    <tr>
                        <th>id</th>
                        <th>Name of recipe</th>
                        <th>Meal type</th>
                        <th>Number of Ingredients</th>
                        <th>Ingredient List</th>
                        <th>Time</th>
                        <th>Method</th>
                        <th>Update</th>
                        <th>Delete</th>
                    </tr>
                </thead>
                <!-- 
                <tbody>
                    <tr>
                        <td>1</td>
                        <td>Banana Bread</td>
                        <td>Snack</td>
                        <td>8</td>
                        <td>3-4 ripe Bananas, 
                            340g flour, 
                            170g sugar, 
                            70g dairy free butter, 
                            1 egg, 
                            1 tbs baking powder, 
                            pinch of salt, 
                            1 tbsp vanilla</td>
                        <td>1 hour 10mins</td>
                        <td>1. Preheat oven to 175 
                            2. Mix the butter and Bananas
                            3. mix the sugar egg and vanilla.
                            4. Add the salt, baking powder and flour and mix well.
                            5. Pour into a loaf tin and bake for 1 hour.
                            6. Leave to cool for 10 mins before removing from the tin.
                        </td>
                        <td><button onclick="editRecipe(1)">update</button></td>
                        <td><button onclick="deleteRecipe(1)">delete</button></td>
                    </tr>
                </tbody>   --> 
    </tbody>
                    <!-- Recipe data will be populated here by JavaScript -->
        </table>
        </div>
        <div id="createForm"></div>
            <h2 id="formTitle">Create a Recipe</h2>
            <form id="recipeForm" onsubmit="return saveRecipe()">
                <input type="hidden" id="recipeId" name="id">
                
                <label>Name of Recipe:</label><br/>
                <input type="text" id="recipeName" required><br/>
    
                <label>Meal Type:</label><br/>
                <input type="text" id="mealType" required><br/>
    
                <label>Number of Ingredients:</label><br/>
                <input type="number" id="ingredientCount" required><br/>
    
                <label>Ingredient List:</label><br/>
                <input type="text" id="ingredientList" required><br/>

                <label>Time:</label><br/>
                <input type="text" id="recipeTime" required><br/>
    
                <label>Method:</label><br/>
                <textarea id="recipeMethod" required></textarea><br/>
    
                <label>Skill Level:</label><br/>
                <select id="difficulty">
                    <option value="Easy">Easy Recipe</option>
                    <option value="Moderate">Some skills required</option>
                    <option value="Difficult">Time and skills required</option>
                </select><br/><br/>               
                
                
            
                <button type="submit">Save Recipe</button>
            </form>    
        </div>
        <script>
            const API_URL = "http://localhost:5000/recipes";
            
            function showCreateForm() {
                document.getElementById("recipeForm").reset();
                document.getElementById("recipeId").value = "";
                document.getElementById("createForm").style.display = "block";
            }
            
            function loadRecipes() {
            fetch(API_URL)
                .then(response => response.json())
                .then(recipes => {
                    const tableBody = document.querySelector("#RecipeTable tbody");
                    tableBody.innerHTML = "";
                    recipes.forEach(recipe => {
                        const row = document.createElement("tr");
                        row.innerHTML = `
                            <td>${recipe.id}</td>
                            <td>${recipe.name}</td>
                            <td>${recipe.meal_type}</td>
                            <td>${recipe.ingredients_count}</td>
                            <td>${recipe.ingredients_list}</td>
                            <td>${recipe.time}</td>
                            <td>${recipe.method}</td>
                            <td><button onclick="editRecipe(${recipe.id})">Update</button></td>
                            <td><button onclick="deleteRecipe(${recipe.id})">Delete</button></td>
                        `;
                        tableBody.appendChild(row);
                    });
                });
        }

            function saveRecipe() {
                const id = document.getElementById("recipeId").value;
                const recipe = {
                    name: document.getElementById("recipeName").value,
                    meal_type: document.getElementById("mealType").value,
                    ingredients_count: parseInt(document.getElementById("ingredientCount").value),
                    ingredients_list: document.getElementById("ingredientList").value,
                    time: document.getElementById("recipeTime").value,
                    method: document.getElementById("recipeMethod").value
                };
<!-- 
                fetch("http://localhost:5000/recipes", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify(data)
                }).then(response => {
                    if (response.ok) {
                        alert("Recipe added successfully!");
                        location.reload();  // Reload to show the updated recipe list
                    } else {
                        alert("Failed to add recipe.");
                    }
                });

                return false; // prevent default form submission
            }
            -->
            
            const method = id ? "PUT" : "POST";
            const url = id ? `${API_URL}/${id}` : API_URL;

            fetch(url, {
                method: method,
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(recipe)
            }).then(response => {
                if (response.ok) {
                    alert("Recipe saved!");
                    document.getElementById("createForm").style.display = "none";
                    loadRecipes();
                } else {
                    alert("Failed to save recipe.");
                }
            });

            return false; // prevent default form submission
        }
            </script>
            <script>
                function editRecipe(id) {
                    // Fetch the recipe data and populate the form for editing
                    fetch(`${API_URL}/${id}`)
                        .then(response => response.json())
                        .then(data => {
                            document.getElementById("recipeId").value = data.id;
                            document.getElementById("recipeName").value = data.name;
                            document.getElementById("mealType").value = data.meal_type;
                            document.getElementById("ingredientCount").value = data.ingredients_count;
                            document.getElementById("ingredientList").value = data.ingredients_list;
                            document.getElementById("recipeTime").value = data.time;
                            document.getElementById("recipeMethod").value = data.method;
                            document.getElementById("createForm").style.display = "block";
                            // Show the form for editing
                        });
                }
            
                function deleteRecipe(id) {
                    fetch(`${API_URL}/${id}`, {
                        method: "DELETE"
                    }).then(response => {
                        if (response.ok) {
                            alert("Recipe deleted successfully!");
                            location.reload();  // Reload to show the updated recipe list
                        } else {
                            alert("Failed to delete recipe.");
                        }
                    });
                }              
            </script>
        <script>
            // Load recipes when the page loads
           document.addEventListener("DOMContentLoaded", function () {
                loadRecipes();
            });  
        </script>
    </body>
</html>